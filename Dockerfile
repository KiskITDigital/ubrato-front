FROM node:21.7.1-alpine3.18@sha256:88a2a0bf05ec222e3b42ba6609c880a3acfa4e98693632aee13686a6b6595c2c

ARG SERVER_URI=https://api.ubrato.ru
ARG TYPESENSE_API_PORT=443
ARG TYPESENSE_API_KEY=q4gLY2ASz9VxsGH67iAHVGkQs0OoWNj9
ARG TYPESENSE_API_URI=search.ubrato.ru
ENV VITE_SERVER_URI=${SERVER_URI}
ENV VITE_TYPESENSE_API_PORT=${TYPESENSE_API_PORT}
ENV VITE_TYPESENSE_API_KEY=${TYPESENSE_API_KEY}
ENV VITE_TYPESENSE_API_URI=${TYPESENSE_API_URI}

ARG PORT=5555
ENV PORT=${PORT}

ARG NODE_ENV
ENV NODE_ENV=${NODE_ENV}

WORKDIR /app
COPY . .
RUN npm install
RUN npm run build
ENTRYPOINT ["node", "server"]
